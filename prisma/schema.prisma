generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = "mysql://root:root@localhost/ahorrapp"
}

model Product {
  ean                 String               @id @db.VarChar(20)
  name                String               @db.VarChar(500)
  description         String?              @db.Text
  brand               String?              @db.VarChar(200)
  imageUrl            String?              @map("image_url") @db.VarChar(1000)
  images              String?              @db.LongText
  category            String?              @db.VarChar(200)
  productUrl          String?              @map("product_url") @db.VarChar(1000)
  created_at          DateTime?            @db.DateTime(0)
  merchantProducts MerchantProduct[]

  @@index([category])
  @@index([brand])
  @@index([name])
  @@map("products")
}

model Merchant {
  id                  Int                  @id @default(autoincrement())
  name                String               @unique @db.VarChar(100)
  cuit                String?              @db.VarChar(20)
  slug                String?              @db.VarChar(255)
  created_at          DateTime?            @default(now()) @db.DateTime(0)
  updated_at          DateTime?            @updatedAt @db.DateTime(0)
  merchantProducts MerchantProduct[]

  @@map("merchants")
}

model MerchantProduct {
  id             Int            @id @default(autoincrement())
  productEan     String         @map("product_ean") @db.VarChar(20)
  merchantId  Int            @map("merchant_id")
  externalId     String?        @map("external_id") @db.VarChar(100)
  productUrl     String?        @map("product_url") @db.VarChar(1000)
  price          Decimal?       @db.Decimal(10, 2)
  listPrice      Decimal?       @map("list_price") @db.Decimal(10, 2)
  referencePrice Decimal?       @map("reference_price") @db.Decimal(10, 2)
  referenceUnit  String?        @map("reference_unit") @db.VarChar(50)
  isAvailable    Boolean        @default(true) @map("is_available")
  lastCheckedAt  DateTime?      @map("last_checked_at")
  priceHistory   PriceHistory[]
  product        Product        @relation(fields: [productEan], references: [ean], onDelete: Cascade)
  merchant    Merchant    @relation(fields: [merchantId], references: [id], onDelete: Cascade)

  @@unique([productEan, merchantId])
  @@index([merchantId])
  @@index([isAvailable])
  @@index([lastCheckedAt])
  @@index([productEan], map: "merchant_products_product_ean_index")
  @@map("merchant_products")
}

model PriceHistory {
  id                   Int                @id @default(autoincrement())
  merchantProductId Int                @map("merchant_product_id")
  price                Decimal            @db.Decimal(10, 2)
  listPrice            Decimal?           @map("list_price") @db.Decimal(10, 2)
  scrapedAt            DateTime           @default(now()) @map("scraped_at")
  merchantProduct   MerchantProduct @relation(fields: [merchantProductId], references: [id], onDelete: Cascade)

  @@index([merchantProductId])
  @@index([scrapedAt])
  @@map("price_history")
}
